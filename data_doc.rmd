---
title: "Capital_Idea"
author: "Ethan Tenison"
date: "6/7/2020"
output: html_document
---

```{r libraries, message=FALSE}
#load libraries
library(haven)
library(dplyr)
library(janitor)
library(stringr)
library(readr)
library(ggplot2)
library(tidyr)
library(readxl)
library(anytime)
library(lubridate)
library(stringr)
library(broom)


```




```{r read}

surveys_casenotes <- read_excel("Semester Surveys with Case Notes.xlsx")

meetinglength <- surveys_casenotes$`Session Minutes`


```

## Data Cleaning 

The data set contains tons of duplicated information. Most students complete the information survey once a semester, although that is not always the case. However, each time a navigator interacts with the student, they input the survey information in again. 
```{r clean}
#Converting dates to date formate
surveys_casenotes$`Survey Date` <- anytime::anydate(surveys_casenotes$`Survey Date`)

#Creating a variable for semester
surveys_casenotes$semester <- ""

for (i in 1:length(surveys_casenotes$`Survey Date`)){
  
  if(surveys_casenotes$`Survey Date`[i] < as.Date("2020-01-01")){        
                    surveys_casenotes$semester[i] <- "Fall 2019"
  }
  else if(surveys_casenotes$`Survey Date`[i] >= as.Date("2020-01-01") & surveys_casenotes$`Survey Date`[i] <= as.Date("2020-06-01") ){
                    surveys_casenotes$semester[i] <- "Spring 2020"
  }
  
}


#Add up total minutes for each student each semester 
surveys_casenotes$`Session Minutes` <- str_replace_all(surveys_casenotes$`Session Minutes`, " Minutes", "")
surveys_casenotes$`Session Minutes` <- as.numeric(surveys_casenotes$`Session Minutes`)

#Changing names to all upper 
surveys_casenotes$First <- toupper(surveys_casenotes$First)
surveys_casenotes$Last <- toupper(surveys_casenotes$Last)

#Getting rid of duplicate rows and sum all the minutes a navigator spent interacting with student per semester
survey <- surveys_casenotes %>% group_by_at(setdiff(names(surveys_casenotes), c("Session Minutes","Case Note", "Note Code", "Note Date Entered","Type of Contact","Note Importance","Note Meeting Date","Semester_Survey.Record ID", "Case_Notes.Record ID"))) %>% summarize(total_session_minutes = sum(`Session Minutes`))

#Removing entries were students took the entire survey multiple times per semester
surveyfall <- filter(survey, semester == "Fall 2019")
surveyfall <- surveyfall[(!duplicated(surveyfall$First) & !duplicated(surveyfall$Last) ), ]

surveyspring <- filter(survey, semester == "Spring 2020")
surveyspring <- surveyspring[(!duplicated(surveyspring$First) & !duplicated(surveyspring$Last) ), ]

surveys_casenotes <- bind_rows(surveyfall, surveyspring)
 



```



```{r plots}

#GGPLOTS

for(i in 1:ncol(surveys_casenotes)){
  

print(
  ggplot(surveys_casenotes, aes(x=surveys_casenotes[[i]])) +
  geom_histogram(stat = "count", fill = "lightblue") +
  xlab(colnames(surveys_casenotes)[i])
  )
  
  
}

```

```{r mult_reg}

#Creating a binary variable for whether a student is in good standing or not. 
for (i in 1:length(surveys_casenotes$`7 What is your current academic standing at ACC?`)) {
    if (surveys_casenotes$`7 What is your current academic standing at ACC?`[i] == "Good standing -") {
        surveys_casenotes$good_standing[i] <- 1
    }
    else {
      surveys_casenotes$good_standing[i] <- 0
    }
}

#removing nas from selected columns
mult_reg <- surveys_casenotes %>% ungroup() %>% dplyr::select(-c(`6a Are you enrolled in College Prep?`,`6b Are you awaiting acceptance into a`,
                                                                 `11d Please specify your OTHER financial`,`23a If yes, please explain`,
                                                                 `Is this an Intake Applicant or a current`, `Survey Date`, `First`,
                                                                 `Last`,`semester`, `26 What are your top two academic goals`,
                                                                 `27 What are your top two personal goals`,
                                                                 `28 What are your top two motivators for`,
                                                                 `29 How can your Career Navigator better`,
                                                                 `Estimated Graduation Date`,
                                                                 `1c Who is your assigned Career Navigator?`))

mult_reg$`1c Who is your assigned Career Navigator?` <- mult_reg$`1c Who is your assigned Career Navigator?` %>% replace_na("Not Assigned")

mult_reg <- na.omit(mult_reg)

# cols <- c("good_standing","Academic  total score","Financial burden total score", "Situational total score",
#           "total_session_minutes","24 What form of transportation do you most commonly use?" )
# mult_reg <- surveys_casenotes[!rowSums(is.na(surveys_casenotes[cols])), ]


#Running the model

model <- glm(good_standing ~ .,
             family=binomial(link='logit'),data=mult_reg,  maxit = 100)

summary(model)



model2 <- glm(good_standing ~ `Academic  total score` + `Financial burden total score`
              + `Situational total score` + `4 Last semester, how many credit hours registered?`
              ,family=binomial(link='logit'),data=mult_reg)

summary(model2)

```