---
title: "Capital_Idea"
author: "Ethan Tenison"
date: "6/7/2020"
output: html_document
---

```{r libraries, message=FALSE}
#load libraries
library(haven)
library(dplyr)
library(janitor)
library(stringr)
library(readr)
library(ggplot2)
library(tidyr)
library(readxl)
library(anytime)
library(lubridate)
library(stringr)


```




```{r read}

surveys_casenotes <- read_excel("Semester Surveys with Case Notes.xlsx")

meetinglength <- surveys_casenotes$`Session Minutes`


```

## Data Cleaning 


```{r clean}
#Converting dates to date formate
surveys_casenotes$`Survey Date` <- anytime::anydate(surveys_casenotes$`Survey Date`)

#Creating a variable for semester
surveys_casenotes$semester <- ""

for (i in 1:length(surveys_casenotes$`Survey Date`)){
  
  if(surveys_casenotes$`Survey Date`[i] <= as.Date("2020-01-01")){        
                    surveys_casenotes$semester[i] <- "Fall 2019"
  }
  else if(surveys_casenotes$`Survey Date`[i] > as.Date("2020-01-01") & surveys_casenotes$`Survey Date`[i] <= as.Date("2020-06-01") ){
                    surveys_casenotes$semester[i] <- "Spring 2020"
  }
  
}


#Add up total minutes for each student each semester 
surveys_casenotes$`Session Minutes` <- str_replace_all(surveys_casenotes$`Session Minutes`, " Minutes", "")
surveys_casenotes$`Session Minutes` <- as.numeric(surveys_casenotes$`Session Minutes`)
test <- surveys_casenotes %>% group_by(First, Last, semester) %>% summarize(total_session_minutes = sum(`Session Minutes`))

test <- surveys_casenotes %>% group_by_at(setdiff(names(surveys_casenotes), c("Session Minutes","Case Note", "Note Code", "Note Date Entered","Type of Contact","Note Importance","Note Meeting Date","Semester_Survey.Record ID", "Case_Notes.Record ID"))) %>% summarize(total_session_minutes = sum(`Session Minutes`))


newd <-  test %>% group_by(First,Last) %>% filter(n()>2) 



```



```{r plots}

#GGPLOTS

for(i in 1:ncol(surveys_casenotes)){
  

print(
  ggplot(surveys_casenotes, aes(x=surveys_casenotes[[i]])) +
  geom_histogram(stat = "count", fill = "lightblue") +
  xlab(colnames(surveys_casenotes)[i])
  )
  
  
}

```

```{r mult_reg}

nasremoved <- na.omit(surveys_casenotes)
#nasremoved$`Academic Priority Level` <- as.factor(nasremoved$`Academic Priority Level`)
#nasremoved$`7 What is your current academic standing at ACC?` <- as.factor(nasremoved$`7 What is your current academic standing at ACC?`)

for (i in 1:length(nasremoved$`7 What is your current academic standing at ACC?`)) {
    if (nasremoved$`7 What is your current academic standing at ACC?`[i] == "Good standing -") {
        nasremoved$binary[i] <- 1
    }
    else {
      nasremoved$binary[i] <- 0
    }
}

#c = lm(nasremoved$`7 What is your current academic standing at ACC?` ~ nasremoved$`Academic Priority Level` + nasremoved$`Financial burden total score`, nasremoved=nasremoved)

model <- glm(nasremoved$binary ~ nasremoved$`Academic Priority Level` + nasremoved$`Financial Priority Level` + nasremoved$`Situational Priority Level`
             + nasremoved$`Session Minutes`,family=binomial(link='logit'),data=nasremoved)
summary(model)

#+ nasremoved$`Financial Priority Level` + nasremoved$`Situational Priority Level`



```